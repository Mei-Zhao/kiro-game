<!DOCTYPE html>
<html>
<head>
    <title>æ¸²æŸ“å™¨ä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        .game-board { 
            display: grid; 
            grid-template-columns: repeat(8, 40px); 
            gap: 2px; 
            margin: 20px 0; 
        }
        .game-cell { 
            width: 40px; 
            height: 40px; 
            border: 1px solid #ccc; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
    </style>
</head>
<body>
    <h1>æ¸²æŸ“å™¨ä¿®å¤æµ‹è¯•</h1>
    <div id="logs"></div>
    
    <!-- åˆ›å»ºæ¸²æŸ“å™¨éœ€è¦çš„DOMç»“æ„ -->
    <div class="game-container">
        <div class="game-board" id="game-board"></div>
        <div id="current-score">0</div>
        <div id="high-score">0</div>
        <div id="game-status">å‡†å¤‡ä¸­...</div>
    </div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="gameModels.js"></script>
    <script src="renderer.js"></script>

    <script>
        const logsDiv = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(div);
            console.log(message);
        }

        function testRenderer() {
            addLog('å¼€å§‹æ¸²æŸ“å™¨æµ‹è¯•', 'info');
            
            try {
                // æ£€æŸ¥ä¾èµ–
                if (typeof Renderer === 'undefined') {
                    addLog('âŒ Rendererç±»æœªæ‰¾åˆ°', 'error');
                    return;
                }
                
                if (typeof GameGrid === 'undefined') {
                    addLog('âŒ GameGridç±»æœªæ‰¾åˆ°', 'error');
                    return;
                }
                
                addLog('âœ… ä¾èµ–æ£€æŸ¥é€šè¿‡', 'success');
                
                // è·å–DOMå…ƒç´ 
                const gameBoard = document.getElementById('game-board');
                const scoreElements = {
                    currentScore: document.getElementById('current-score'),
                    highScore: document.getElementById('high-score')
                };
                const statusElement = document.getElementById('game-status');
                
                addLog('âœ… DOMå…ƒç´ è·å–æˆåŠŸ', 'success');
                
                // åˆ›å»ºæ¸²æŸ“å™¨
                addLog('åˆ›å»ºæ¸²æŸ“å™¨å®ä¾‹...', 'info');
                const renderer = new Renderer(gameBoard, scoreElements, statusElement);
                addLog('âœ… æ¸²æŸ“å™¨å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // åˆå§‹åŒ–æ¸²æŸ“å™¨
                addLog('åˆå§‹åŒ–æ¸²æŸ“å™¨...', 'info');
                renderer.initialize();
                addLog('âœ… æ¸²æŸ“å™¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                // åˆ›å»ºæ¸¸æˆç½‘æ ¼å¹¶æ¸²æŸ“
                addLog('åˆ›å»ºæ¸¸æˆç½‘æ ¼...', 'info');
                const gameGrid = new GameGrid();
                addLog('âœ… æ¸¸æˆç½‘æ ¼åˆ›å»ºæˆåŠŸ', 'success');
                
                // æ¸²æŸ“ç½‘æ ¼
                addLog('æ¸²æŸ“æ¸¸æˆç½‘æ ¼...', 'info');
                renderer.renderGrid(gameGrid);
                addLog('âœ… æ¸¸æˆç½‘æ ¼æ¸²æŸ“æˆåŠŸ', 'success');
                
                // æµ‹è¯•renderGameæ–¹æ³•
                addLog('æµ‹è¯•renderGameæ–¹æ³•...', 'info');
                renderer.renderGame(gameGrid);
                addLog('âœ… renderGameæ–¹æ³•æ‰§è¡ŒæˆåŠŸ', 'success');
                
                // æµ‹è¯•é˜²æŠ–æ¸²æŸ“
                if (renderer.debouncedRender) {
                    addLog('æµ‹è¯•é˜²æŠ–æ¸²æŸ“...', 'info');
                    renderer.debouncedRender();
                    addLog('âœ… é˜²æŠ–æ¸²æŸ“æ‰§è¡ŒæˆåŠŸ', 'success');
                } else {
                    addLog('âš ï¸ é˜²æŠ–æ¸²æŸ“æœªè®¾ç½®', 'error');
                }
                
                addLog('ğŸ‰ æ‰€æœ‰æ¸²æŸ“å™¨æµ‹è¯•é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                addLog(`âŒ æ¸²æŸ“å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                addLog(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            addLog('é¡µé¢åŠ è½½å®Œæˆ', 'info');
            setTimeout(testRenderer, 100);
        });
    </script>
</body>
</html>