<!DOCTYPE html>
<html>
<head>
    <title>GameEngineåˆå§‹åŒ–è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <h1>GameEngineåˆå§‹åŒ–è°ƒè¯•</h1>
    <div id="logs"></div>
    
    <!-- åˆ›å»ºå®Œæ•´çš„æ¸¸æˆå®¹å™¨ç»“æ„ -->
    <div class="game-container">
        <div class="game-board"></div>
        <div id="current-score">0</div>
        <div id="high-score">0</div>
        <div id="game-status">å‡†å¤‡ä¸­...</div>
        <button id="start-btn">å¼€å§‹</button>
        <button id="pause-btn">æš‚åœ</button>
        <button id="restart-btn">é‡æ–°å¼€å§‹</button>
        <button id="sound-btn">éŸ³æ•ˆ</button>
    </div>

    <!-- æŒ‰ç…§æ­£ç¡®é¡ºåºåŠ è½½æ‰€æœ‰ä¾èµ– -->
    <script src="gameModels.js"></script>
    <script src="scoreSystem.js"></script>
    <script src="storageManager.js"></script>
    <script src="audioSystem.js"></script>
    <script src="performanceOptimizer.js"></script>
    <script src="renderer.js"></script>
    <script src="inputHandler.js"></script>
    <script src="gameEngine.js"></script>

    <script>
        const logsDiv = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(div);
            console.log(message);
        }

        // é‡å†™consoleæ–¹æ³•æ¥æ•è·æ‰€æœ‰æ—¥å¿—
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        console.log = function(...args) {
            addLog(args.join(' '), 'info');
            originalConsoleLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog(args.join(' '), 'error');
            originalConsoleError.apply(console, args);
        };

        async function testGameEngineInit() {
            addLog('å¼€å§‹GameEngineåˆå§‹åŒ–æµ‹è¯•', 'info');
            
            try {
                // æ£€æŸ¥æ‰€æœ‰å¿…éœ€çš„ä¾èµ–
                addLog('æ£€æŸ¥ä¾èµ–é¡¹...', 'info');
                
                const dependencies = [
                    'createInitialGameState', 'createScoreSystem', 'createStorageManagerWithFallback',
                    'GameGrid', 'MatchDetector', 'AudioSystem', 'Renderer', 'InputHandler',
                    'createGameEngine', 'GAME_CONFIG'
                ];
                
                let missingDeps = [];
                dependencies.forEach(dep => {
                    if (typeof window[dep] === 'undefined') {
                        missingDeps.push(dep);
                    }
                });
                
                if (missingDeps.length > 0) {
                    addLog(`âŒ ç¼ºå°‘ä¾èµ–: ${missingDeps.join(', ')}`, 'error');
                    return;
                }
                
                addLog('âœ… æ‰€æœ‰ä¾èµ–é¡¹æ£€æŸ¥é€šè¿‡', 'success');
                
                // æ£€æŸ¥DOMå…ƒç´ 
                addLog('æ£€æŸ¥DOMå…ƒç´ ...', 'info');
                const gameContainer = document.querySelector('.game-container');
                const gameBoard = gameContainer.querySelector('.game-board');
                const currentScore = gameContainer.querySelector('#current-score');
                const highScore = gameContainer.querySelector('#high-score');
                const gameStatus = gameContainer.querySelector('#game-status');
                
                addLog(`æ¸¸æˆå®¹å™¨: ${gameContainer ? 'âœ…' : 'âŒ'}`, gameContainer ? 'success' : 'error');
                addLog(`æ¸¸æˆæ¿: ${gameBoard ? 'âœ…' : 'âŒ'}`, gameBoard ? 'success' : 'error');
                addLog(`å½“å‰åˆ†æ•°: ${currentScore ? 'âœ…' : 'âŒ'}`, currentScore ? 'success' : 'error');
                addLog(`æœ€é«˜åˆ†: ${highScore ? 'âœ…' : 'âŒ'}`, highScore ? 'success' : 'error');
                addLog(`æ¸¸æˆçŠ¶æ€: ${gameStatus ? 'âœ…' : 'âŒ'}`, gameStatus ? 'success' : 'error');
                
                // åˆ›å»ºGameEngine
                addLog('åˆ›å»ºGameEngineå®ä¾‹...', 'info');
                const gameEngine = createGameEngine(gameContainer);
                addLog('âœ… GameEngineå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // åˆå§‹åŒ–GameEngine
                addLog('å¼€å§‹åˆå§‹åŒ–GameEngine...', 'info');
                const initResult = await gameEngine.initialize();
                
                if (initResult) {
                    addLog('ğŸ‰ GameEngineåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    
                    const status = gameEngine.getStatus();
                    addLog(`çŠ¶æ€: ${status.state}`, 'info');
                    addLog(`åˆ†æ•°: ${status.score}`, 'info');
                    addLog(`æœ€é«˜åˆ†: ${status.highScore}`, 'info');
                    
                    // æ¸…ç†
                    gameEngine.destroy();
                    addLog('âœ… GameEngineæ¸…ç†å®Œæˆ', 'success');
                } else {
                    addLog('âŒ GameEngineåˆå§‹åŒ–å¤±è´¥', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}`, 'error');
                addLog(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            addLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•', 'info');
            setTimeout(testGameEngineInit, 100); // ç¨å¾®å»¶è¿Ÿä»¥ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
        });
    </script>
</body>
</html>